CREATE TABLE TB_JOB_RUN (
                            ID           NUMBER(19,0) GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                            JOB_ID       NUMBER(19,0)      NOT NULL,
                            RUN_KEY      VARCHAR2(40 CHAR) NOT NULL,

                            STATUS       VARCHAR2(20 CHAR) NOT NULL
                                CHECK (STATUS IN ('CREATED','RUNNING','DONE','FAILED','CANCELLED','EXPIRED')),

                            CREATED_AT   TIMESTAMP(6) WITH LOCAL TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
                            UPDATED_AT   TIMESTAMP(6) WITH LOCAL TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,

                            DEADLINE_AT  TIMESTAMP(6) WITH LOCAL TIME ZONE NOT NULL,
                            STARTED_AT   TIMESTAMP(6) WITH LOCAL TIME ZONE,
                            FINISHED_AT  TIMESTAMP(6) WITH LOCAL TIME ZONE,

                            CONSTRAINT FK_JOB_RUN_JOB FOREIGN KEY (JOB_ID) REFERENCES TB_JOB(ID),
                            CONSTRAINT UX_JOB_RUN UNIQUE (JOB_ID, RUN_KEY)
);

CREATE INDEX IX_JOB_RUN_JOB    ON TB_JOB_RUN (JOB_ID);
CREATE INDEX IX_JOB_RUN_STATUS ON TB_JOB_RUN (STATUS);
